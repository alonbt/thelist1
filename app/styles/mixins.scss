@import "compass/css3/background-size";

$sprites: sprite-map("1x/*.png");
$sprites2x: sprite-map("2x/*.png");

@mixin sprite-position-retina($spriteUrl, $name) {
  $spriteData: sprite-position($spriteUrl, $name);
  $x: nth($spriteData,1)/2;
  $y: nth($spriteData,2)/2;
  background-position: $x $y;
}

@mixin retina-media() {
  @media (min--moz-device-pixel-ratio: 1.3),
  (-webkit-min-device-pixel-ratio: 1.3),
  (min-device-pixel-ratio: 1.3),
  (min-resolution: 1.3dppx) {
    @content;
  }
}

@mixin sprite($name) {
  text-indent: -9999px;
  background-repeat: no-repeat;
  background-image: sprite-url($sprites);
  background-position: sprite-position($sprites, $name);
  height: image-height(sprite-file($sprites, $name));
  width: image-width(sprite-file($sprites, $name));

  @include retina-media() {
    background-image: sprite-url($sprites2x);
    @include sprite-position-retina($sprites2x, $name);
    @include background-size( ceil(image-width(sprite-path($sprites2x)) / 2) ceil(image-height(sprite-path($sprites2x)) / 2) );
  };
}
